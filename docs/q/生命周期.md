# Vue ç”Ÿå‘½å‘¨æœŸ

> æ¯ä¸ª Vue å®ä¾‹åœ¨è¢«åˆ›å»ºæ—¶éƒ½è¦ç»å†ä¸€ç³»åˆ—çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚

ä¾‹å¦‚éœ€è¦è®¾ç½®æ•°æ®ç›‘å¬ã€æ¨¡æ¿ç¼–è¯‘ã€æŒ‚è½½å®ä¾‹åˆ° DOMã€åœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° DOMç­‰ç­‰ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¼šè¿è¡Œä¸€äº›ç”Ÿå‘½å‘¨æœŸé’©å­çš„å‡½æ•°ï¼Œç»™ä¸ç”¨æˆ·æœºä¼šåœ¨ä¸åŒé˜¶æ®µæ·»åŠ è‡ªå·±çš„ä»£ç ã€‚

ç”Ÿå‘½å‘¨æœŸé’©å­ä¸­çš„ `this` ä¸Šä¸‹æ–‡æŒ‡å‘è°ƒç”¨å®ƒçš„ Vue å®ä¾‹

### beforeCreate & created
```js
Vue.prototype._init = function (options?: Object) {
  // ...
  initLifecycle(vm)
  initEvents(vm)
  initRender(vm)
  callHook(vm, 'beforeCreate')
  initInjections(vm) // resolve injections before data/props
  initState(vm)
  initProvide(vm) // resolve provide after data/props
  callHook(vm, 'created')
  // ...
}
```
`initState` çš„ä½œç”¨æ˜¯ï¼šåˆå§‹åŒ– props data methods watch computed ç­‰å±æ€§

æ‰€ä»¥ beforeCreate çš„é’©å­å‡½æ•°ä¸­å°±ä¸èƒ½è·å– props data ä¸­å®šä¹‰çš„å€¼ï¼Œä¹Ÿä¸èƒ½è°ƒç”¨ methods ä¸­å®šä¹‰çš„æ–¹æ³•

è¿™ä¸¤ä¸ªé’©å­å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ¸²æŸ“ DOMï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½è®¿é—® DOMã€‚æŒ‚è½½é˜¶æ®µè¿˜æ²¡å¼€å§‹ï¼Œ`$el` ä¸å¯è§ã€‚

ğŸŒ¹ ä½¿ç”¨åœºæ™¯ï¼š

- ç»„ä»¶åŠ è½½çš„æ—¶å€™éœ€è¦å’Œåå°äº¤äº’ï¼Œé‚£ä¹ˆæ”¾åœ¨ `beforeCreate` å’Œ `created` éƒ½å¯ä»¥
- éœ€è¦è®¿é—® props data ç­‰æ•°æ®çš„è¯ï¼Œä½¿ç”¨ `created` ï¼Œã€Œç®€å•çš„ ajax è¯·æ±‚ã€
- è¿™ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­å¸¸å¸¸ç”¨æ¥åˆå§‹åŒ– ã€Œéå“åº”å¼å±æ€§ã€

### beforeMount & mounted

`beforeMount` æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨

`mounted`  el è¢«æ–°åˆ›å»ºçš„ vm.$el æ›¿æ¢ï¼ŒæŒ‚è½½åˆ°å®ä¾‹ä¸Šå»åè°ƒç”¨ `mounted`

æ­¤æ—¶å¯ä»¥è®¿é—®åˆ° DOM

`mounted` ä¸ä¼šæ‰¿è¯ºæ‰€æœ‰çš„å­ç»„ä»¶ä¸€èµ·è¢«æŒ‚è½½ã€‚

- beforeMount é’©å­å¥½åƒæ²¡å•¥å®é™…ä½¿ç”¨åœºæ™¯è¯¶

### beforeUpdate & updated

`beforeUpdate` å‘ç”Ÿåœ¨è™šæ‹Ÿ DOM æ‰“è¡¥ä¸å‰ï¼Œé€‚åˆåœ¨æ›´æ–°ä¹‹å‰è®¿é—®ç°æœ‰çš„ DOMï¼Œæ¯”å¦‚æ‰‹åŠ¨ç§»é™¤å·²æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨ã€‚

- data æ›´æ–°äº†ï¼Œä½†æ˜¯ è™šæ‹Ÿ DOM è¿˜æœªæ›´æ–° â€”-beforeUpdate

`updated` ç”±äºæ•°æ®çš„æ›´æ”¹å¯¼è‡´è™šæ‹Ÿ DOM é‡æ–°æ¸²æŸ“å’Œæ‰“è¡¥ä¸ï¼Œåœ¨è¿™ä¹‹åè°ƒç”¨è¯¥é’©å­ã€‚

### beforeDestroy & destroyed

`beforeDestroy` å®ä¾‹é”€æ¯ä¹‹å‰

`destroyed` å®ä¾‹é”€æ¯ä¹‹åï¼Œè°ƒç”¨åï¼ŒVue å®ä¾‹æ‰€æœ‰çš„ä¸œè¥¿éƒ½è§£ç»‘ï¼Œæ‰€æœ‰çš„äº‹ä»¶ç›‘å¬å™¨è¢«ç§»é™¤ï¼Œæ‰€æœ‰çš„å­å®ä¾‹è¢«é”€æ¯ã€‚

(å®šæ—¶å™¨é”€æ¯å·¥ä½œï¼‰

- beforeDestroy : é€‚ç”¨äºå®šæ—¶å™¨çš„é”€æ¯
- destroyed è¿™æ—¶å€™å®ä¾‹è¢«**é”€æ¯**ï¼Œè¢«é”€æ¯æ„å‘³ç€ä»€ä¹ˆå‘¢ ï¼Ÿåœ¨æ‰§è¡Œ destroyed æ–¹æ³•åï¼Œå¯¹ data é‡Œé¢å±æ€§çš„æ”¹å˜ä¸ä¼šå†å‡ºå‘ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œæ„å‘³ç€é‚£ä¸ªå“åº”å¼å±æ€§å·²ç»ä¸æ˜¯å“åº”å¼äº†ï¼ŒVue å®ä¾‹è§£é™¤äº†äº‹ä»¶ç›‘å¬ä¸ DOM çš„ç»‘å®šï¼Œä¸è¿‡ DOM å…ƒç´ è¿˜åœ¨ã€‚

è¿˜æœ‰

### activated & deactivated

### errorCaptured

```js
// æºç 

new Vue({})

// åˆå§‹åŒ–Vueå®ä¾‹
function _init() {
	 // æŒ‚è½½å±æ€§
    initLifeCycle(vm) 
    // åˆå§‹åŒ–äº‹ä»¶ç³»ç»Ÿï¼Œé’©å­å‡½æ•°ç­‰
    initEvent(vm) 
    // ç¼–è¯‘slotã€vnode
    initRender(vm) 
    // è§¦å‘é’©å­
    callHook(vm, 'beforeCreate')
    // æ·»åŠ injectåŠŸèƒ½
    initInjection(vm)
    // å®Œæˆæ•°æ®å“åº”æ€§ props/data/watch/computed/methods
    initState(vm)
    // æ·»åŠ  provide åŠŸèƒ½
    initProvide(vm)
    // è§¦å‘é’©å­
    callHook(vm, 'created')
		
	 // æŒ‚è½½èŠ‚ç‚¹
    if (vm.$options.el) {
        vm.$mount(vm.$options.el)
    }
}

// æŒ‚è½½èŠ‚ç‚¹å®ç°
function mountComponent(vm) {
	 // è·å– render function
    if (!this.options.render) {
        // template to render
        // Vue.compile = compileToFunctions
        let { render } = compileToFunctions() 
        this.options.render = render
    }
    // è§¦å‘é’©å­
    callHook('beforeMounte')
    // åˆå§‹åŒ–è§‚å¯Ÿè€…
    // render æ¸²æŸ“ vdomï¼Œ 
    vdom = vm.render()
    // update: æ ¹æ® diff å‡ºçš„ patchs æŒ‚è½½æˆçœŸå®çš„ dom 
    vm._update(vdom)
    // è§¦å‘é’©å­  
    callHook(vm, 'mounted')
}

// æ›´æ–°èŠ‚ç‚¹å®ç°
funtion queueWatcher(watcher) {
	nextTick(flushScheduleQueue)
}

// æ¸…ç©ºé˜Ÿåˆ—
function flushScheduleQueue() {
	 // éå†é˜Ÿåˆ—ä¸­æ‰€æœ‰ä¿®æ”¹
    for(){
	    // beforeUpdate
        watcher.before()
         
        // ä¾èµ–å±€éƒ¨æ›´æ–°èŠ‚ç‚¹
        watcher.update() 
        callHook('updated')
    }
}

// é”€æ¯å®ä¾‹å®ç°
Vue.prototype.$destory = function() {
	 // è§¦å‘é’©å­
    callHook(vm, 'beforeDestory')
    // è‡ªèº«åŠå­èŠ‚ç‚¹
    remove() 
    // åˆ é™¤ä¾èµ–
    watcher.teardown() 
    // åˆ é™¤ç›‘å¬
    vm.$off() 
    // è§¦å‘é’©å­
    callHook(vm, 'destoryed')
}
```
- _init_

```js
initLifecycle/Eventï¼Œå¾€vmä¸ŠæŒ‚è½½å„ç§å±æ€§
callHook: beforeCreated: å®ä¾‹åˆšåˆ›å»º
initInjection/initState: åˆå§‹åŒ–æ³¨å…¥å’Œ data å“åº”æ€§
created: åˆ›å»ºå®Œæˆï¼Œå±æ€§å·²ç»ç»‘å®šï¼Œ ä½†è¿˜æœªç”ŸæˆçœŸå®dom
è¿›è¡Œå…ƒç´ çš„æŒ‚è½½ï¼š $el / vm.$mount()
æ˜¯å¦æœ‰template: è§£ææˆrender function
*.vueæ–‡ä»¶: vue-loaderä¼šå°†<template>ç¼–è¯‘æˆrender function
beforeMount: æ¨¡æ¿ç¼–è¯‘/æŒ‚è½½ä¹‹å‰
æ‰§è¡Œrender functionï¼Œç”ŸæˆçœŸå®çš„domï¼Œå¹¶æ›¿æ¢åˆ°dom treeä¸­
mounted: ç»„ä»¶å·²æŒ‚è½½
```

- update:
```js
æ‰§è¡Œdiffç®—æ³•ï¼Œæ¯”å¯¹æ”¹å˜æ˜¯å¦éœ€è¦è§¦å‘UIæ›´æ–°
flushScheduleQueue

watcher.before: è§¦å‘beforeUpdateé’©å­		- watcher.run(): æ‰§è¡Œwatcherä¸­çš„ notifyï¼Œé€šçŸ¥æ‰€æœ‰ä¾èµ–é¡¹æ›´æ–°UI

è§¦å‘updatedé’©å­: ç»„ä»¶å·²æ›´æ–°
```

- actived / deactivated(keep-alive): ä¸é”€æ¯ï¼Œç¼“å­˜ï¼Œç»„ä»¶æ¿€æ´»ä¸å¤±æ´»

- destroy:
```js
beforeDestroy: é”€æ¯å¼€å§‹
é”€æ¯è‡ªèº«ä¸”é€’å½’é”€æ¯å­ç»„ä»¶ä»¥åŠäº‹ä»¶ç›‘å¬
remove(): åˆ é™¤èŠ‚ç‚¹
watcher.teardown(): æ¸…ç©ºä¾èµ–
vm.$off(): è§£ç»‘ç›‘å¬
destroyed: å®Œæˆåè§¦å‘é’©å­
```