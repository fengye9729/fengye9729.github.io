# 内存空间
因为 JavaScript 具有垃圾回收机制♻️，所以大家对内存空间的认识不够深刻。可是如果对它模糊，会造成对其他知识点的理解不够深刻，比如深浅拷贝、基本类型与引用类型等等。

在阐述内存空间之前，首先介绍下三种数据结构：堆、栈、队列

在 JavaScript 中，并没有严格区分堆内存与栈内存。我们可以理解为在 JavaScript 中绝大多数的数据结构都是堆内存，但是在某些场景下，我们还是需要区分堆内存与栈内存，比如：执行上下文的执行顺序就借用了栈数据结构的存取方式。

- 堆数据结构是树状结构，存取数据的方式类似书架与书，它并不关心数据的先后顺序，只关心 `key-value`
- 栈数据结构是「先进后出，后进先出」
- 队列数据结构是「先进先出，后进后出」

### 内存泄露的场景
- 意外的**全局变量**: 无法被回收
- **定时器**: 未被正确关闭，导致所引用的外部变量无法被释放
- **事件监听**: 没有正确销毁 (低版本浏览器可能出现)
- **闭包**: 会导致父级中的变量无法被释放
- **dom 引用**: dom 元素被删除时，内存中的引用未被正确清空

可用 chrome 中的 `timeline` 进行内存标记，可视化查看内存的变化情况，找出异常点。

### 基本数据类型与变量对象

JavaScript 执行上下文生成后，会创建**变量对象**，JavaScript 的基本数据类型会保存在变量对象中。
JavaScript 的基本数据类型有：Undefined、Null、Boolean、Number、String，Symbol

基本数据类型是**按值访问**，我们可以直接操作保存在变量中的实际的值。

### 引用数据类型与堆内存

JavaScript 的引用数据类型，比如数组，它的大小是不固定的。**引用数据类型的值是保存在堆内存中的**。

JavaScript 不允许直接访问堆内存，因此我们不能直接操作堆内存空间。

在操作对象时，实际上是在操作对象的引用而不是实际的对象。

引用类型的值是**按引用访问的**。这里的引用是指保存在变量对象中的一个地址，这个地址与堆内存中的实际值相关联。

![memory-space](../.vuepress/public/images/space.jpg)

因此当我们要访问堆内存中的引用数据类型时，实际上我们是先从变量对象中取出该对象的地址引用，然后再到堆内存中取出我们需要的数据。

JavaScript 的垃圾回收机制的原理是找出那些不再引用的数据，释放其占用的内存。垃圾收集器每隔一段时间就执行一次释放操作。
最常用的是通过**标记清除**的算法来找到哪些对象不再使用。
比如 `a=null` 实际上是一次释放引用的操作，让 a 原本的值失去引用，脱离执行环境。这个值会在下次垃圾收集器执行时被找到并释放。而在恰当的时间解除引用，能够让页面性能提升。

在局部作用域中，当函数执行完毕，局部变量也就没有存在的必要，因此很容易被垃圾收集器找到并释放。

但是全局变量什么时候需要释放内存空间很难判断。因此我们需要尽量减少全局变量的使用。

[参考地址：前端基础进阶（一）：内存空间详细图解](https://segmentfault.com/a/1190000012646195)